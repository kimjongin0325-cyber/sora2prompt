<script>
        // 전역 변수: 복사 실패 메시지가 이미 출력되었는지 여부를 추적합니다.
        let hasAlertedCopyFailure = false; 

        // 드라마 장르 전용 프롬프트 생성 함수 (이전과 동일)
        function generatePrompt() {
            const userInput = document.getElementById('userInput').value.trim();
            
            if (!userInput) {
                alert('아이디어를 입력해주세요!');
                return;
            }

            // ... (프롬프트 템플릿 생성 로직은 이전과 동일) ...
            let prompt = '';
            
            // API Parameters
            prompt += '=== API Parameters ===\n';
            prompt += 'Model: sora-2-pro\n';
            prompt += 'Size: 1920x1080 (가로형 - 영화 최적화)\n'; 
            prompt += 'Seconds: 12\n\n'; 

            prompt += '=== Video Prompt ===\n\n';

            prompt += 'Style: Deeply cinematic look with **soft focus and shallow depth of field (Bokeh)**, emphasizing the subject’s emotion. **Muted, painterly color grading** reminiscent of a classic independent film. 4K digital cinema quality with natural, subtle film grain. High emotional resonance.\n\n';

            // 사용자 입력을 기반으로 Scene Description 생성
            prompt += `Scene Description:\n**INTENSE EMOTIONAL MOMENT.** ${userInput}. Focus on subtle facial expressions and body language.\n\n`;

            // Cinematography (드라마: 인물의 내면 포착)
            prompt += 'Cinematography:\n';
            prompt += 'Camera shot: **Tight close-up shot** or **Medium close-up** to capture subtle facial expressions\n';
            prompt += 'Lens: **85mm prime lens** (Portrait lens) for background compression and intimate feel\n';
            prompt += 'Lighting: Soft, motivated light (e.g., window light or single practical lamp), **Chiaroscuro style** (명암 대비) for emotional shadows\n'; 
            prompt += 'Mood: Melancholy, introspective, heartfelt\n\n';

            // Actions (드라마: 감정의 흐름 강조)
            prompt += 'Actions (3 Cuts for 12-second video):\n';
            prompt += '- Cut 1 (0:00 - 4.0s): **Establishing Emotion** - A medium shot setting the scene and the character’s initial state with a slow, gentle camera drift. (4.0 seconds)\n';
            prompt += '- Cut 2 (4.0s - 8.0s): **Core Moment** - A close-up on the face or a meaningful object as the key emotional action or reaction occurs. (4.0 seconds)\n';
            prompt += '- Cut 3 (8.0s - 12s): **Emotional Resonance** - A final, lingering shot, perhaps with a slow zoom out or reverse shot, leaving the viewer with the residual mood. (4.0 seconds)\n\n';

            // Camera Movement (드라마: 느리고 섬세함)
            prompt += 'Camera Movement:\n';
            prompt += '**Slow, deliberate Dolly or Steadicam motion**. Gentle push-in to increase emotional intimacy. Minimal movement to keep focus on the subject. **Avoid rapid movements.**\n\n';

            // Palette (드라마: 분위기 중심)
            prompt += 'Color Palette:\n';
            prompt += 'Warm, desaturated tones (Sepia or Earthy tones) or cool blues and greys, depending on the mood. High contrast between light and shadow (Chiaroscuro).\n\n';

            // Background Sound
            prompt += 'Background Sound:\n';
            prompt += 'Subtle diegetic sound (rain, clock ticking, sigh) with **minimal, non-intrusive ambient music track** (e.g., a single piano chord).\n\n';

            // 추가 가이드
            prompt += '=== Production Notes ===\n';
            prompt += '- Emphasize realistic, nuanced emotional expression\n';
            prompt += '- Utilize negative space and bokeh effectively\n';
            prompt += '- Focus on the quality of light and shadows\n';
            prompt += '- **Avoid rapid editing or excessive action**\n';

            // Display output
            document.getElementById('promptOutput').textContent = prompt;
            document.getElementById('outputSection').style.display = 'block';
            
            // Scroll to output
            setTimeout(() => {
                document.getElementById('outputSection').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'nearest' 
                });
            }, 100);
        }

        // 복사 함수 수정 (한 번만 알림)
        function copyPrompt() {
            const promptText = document.getElementById('promptOutput').textContent;
            
            if (!promptText) {
                alert('먼저 프롬프트를 생성해주세요!');
                return;
            }

            navigator.clipboard.writeText(promptText).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '✅ 복사완료!';
                btn.style.background = 'rgba(34, 197, 94, 0.3)';
                btn.style.borderColor = '#22c55e';
                btn.style.color = '#22c55e';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    // 드라마 색상 복구
                    btn.style.background = 'rgba(32, 178, 170, 0.2)'; 
                    btn.style.borderColor = '#20b2aa';
                    btn.style.color = '#20b2aa';
                }, 2000);
            }).catch(err => {
                // 실패 시, 이전에 메시지를 출력하지 않았을 경우에만 실행
                if (!hasAlertedCopyFailure) {
                    alert('⚠️ 복사에 실패했습니다. (보안 정책 문제일 수 있음)');
                    // 메시지 출력 후 상태를 true로 변경하여 다음부터는 나오지 않게 합니다.
                    hasAlertedCopyFailure = true; 
                    console.error('클립보드 복사 실패:', err);
                }
                // 실패했더라도 버튼의 원상 복구 로직은 유지하거나, 그대로 둡니다.
            });
        }

        // Enter 키로 생성 (이전과 동일)
        document.getElementById('userInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                generatePrompt();
            }
        });
    </script>
